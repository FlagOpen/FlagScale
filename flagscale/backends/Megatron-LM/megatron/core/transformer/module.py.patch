diff --git a/megatron/core/transformer/module.py b/megatron/core/transformer/module.py
index ff7dc7763..915a75f49 100644
--- a/megatron/core/transformer/module.py
+++ b/megatron/core/transformer/module.py
@@ -258,15 +258,30 @@ class Float16Module(MegatronModule):
             The wrapped module's outputs, potentially upcast to fp32 depending on pipeline stage
             and ``fp32_output``.
         """
-        if parallel_state.is_pipeline_first_stage(ignore_virtual=False, vp_stage=self.vp_stage):
-            inputs = fp32_to_float16(inputs, self.float16_convertor)
-        outputs = self.module(*inputs, **kwargs)
-        if (
+        ######### FlagScale Begin ########
+        #TODO: Fix the dualpipev import issue in the latest Megatron codebase
+        # from flagscale.train.dualpipev.dualpipev_schedules import get_dualpipe_chunk
+        if self.config.use_dualpipev:
+            from flagscale.train.dualpipev.dualpipev_schedules import get_dualpipe_chunk
+            dualpipe_first_stage = parallel_state.is_pipeline_first_stage() and get_dualpipe_chunk() == 0
+            if dualpipe_first_stage:
+                inputs = fp32_to_float16(inputs, self.float16_convertor)
+            outputs = self.module(*inputs, **kwargs)
+            dualpipe_last_stage = parallel_state.is_pipeline_first_stage() and get_dualpipe_chunk() == 1
+            if dualpipe_last_stage:
+                outputs = float16_to_fp32(outputs)
+            return outputs
+        ######### FlagScale End ########
+        else:
+            if parallel_state.is_pipeline_first_stage(ignore_virtual=False, vp_stage=self.vp_stage):
+                inputs = fp32_to_float16(inputs, self.float16_convertor)
+            outputs = self.module(*inputs, **kwargs)
+            if (
             parallel_state.is_pipeline_last_stage(ignore_virtual=False, vp_stage=self.vp_stage)
             and fp32_output is True
         ):
-            outputs = float16_to_fp32(outputs)
-        return outputs
+                outputs = float16_to_fp32(outputs)
+            return outputs
 
     def state_dict(
         self, destination=None, prefix='', keep_vars=False
